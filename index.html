<!DOCTYPE html>

<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø§Ø³ØªØ¨ÙŠØ§Ù† Ø§Ù„Ù†Ø§Ø¯ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ - ÙƒÙˆÙ„Ø´ÙŠØ³ØªØ±</title>

  <!-- React 18 -->

  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>

  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel (unchanged, still for JSX support) -->

  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind -->

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body { margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
  </style>

</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;

    /*
      SECURITY FIX:
      âŒ GitHub token REMOVED from frontend
      âœ… Submissions are now sent to a backend endpoint instead
      ðŸ‘‰ You must implement this endpoint server-side
    */

    const BACKEND_ENDPOINT = '/.netlify/functions/submit-survey';


    /*
      FIX #3 (GitHub dispatch reliability):
      The frontend now EXPECTS a proper JSON response from the backend.
      Backend must:
      - Trigger GitHub repository_dispatch
      - Return { success: true }
      - Return HTTP 4xx/5xx with message on failure
    */

    function SaudiStudentSurvey() {
      const [formData, setFormData] = useState({
        gender: '',
        age: '',
        studyLevel: '',
        activities: [],
        culturalActivities: [],
        socialActivities: [],
        sportsActivities: [],
        educationalActivities: [],
        eventFrequency: '',
        preferredTime: [],
        familyActivities: '',
        expectations: [],
        communicationMethod: [],
        volunteerInterest: '',
        suggestions: '',
        contactInfo: ''
      });

      const [isSubmitting, setIsSubmitting] = useState(false);

      const activities = [
        'Ø£Ù†Ø´Ø·Ø© Ø«Ù‚Ø§ÙÙŠØ©','Ø£Ù†Ø´Ø·Ø© Ø±ÙŠØ§Ø¶ÙŠØ©','Ø£Ù†Ø´Ø·Ø© Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©','Ù…Ø­Ø§Ø¶Ø±Ø§Øª ÙˆÙˆØ±Ø´ Ø¹Ù…Ù„','Ø±Ø­Ù„Ø§Øª ØªØ±ÙÙŠÙ‡ÙŠØ©','ÙØ¹Ø§Ù„ÙŠØ§Øª Ø¹Ø§Ø¦Ù„ÙŠØ©','Ø£Ù†Ø´Ø·Ø© Ø¯ÙŠÙ†ÙŠØ©'
      ];

      const culturalOptions = [
        'Ø§Ù„Ø§Ø­ØªÙØ§Ù„ Ø¨Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª Ø§Ù„ÙˆØ·Ù†ÙŠØ©','Ø§Ù„Ø£Ù…Ø³ÙŠØ§Øª Ø§Ù„Ø´Ø¹Ø±ÙŠØ© ÙˆØ§Ù„Ø£Ø¯Ø¨ÙŠØ©','Ø§Ù„Ù…Ø¹Ø§Ø±Ø¶ Ø§Ù„ÙÙ†ÙŠØ© ÙˆØ§Ù„ØªØ±Ø§Ø«ÙŠØ©','ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù„Ù„Ø£Ø¨Ù†Ø§Ø¡','Ø¯Ø±ÙˆØ³ Ø§Ù„Ø®Ø· Ø§Ù„Ø¹Ø±Ø¨ÙŠ ÙˆØ§Ù„ÙÙ†ÙˆÙ† Ø§Ù„ØªÙ‚Ù„ÙŠØ¯ÙŠØ©'
      ];

      const socialOptions = [
        'Ù„Ù‚Ø§Ø¡Ø§Øª ØªØ¹Ø§Ø±Ù Ø¯ÙˆØ±ÙŠØ©','Ø­ÙÙ„Ø§Øª Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø¬Ø¯Ø¯','ØªØ¬Ù…Ø¹Ø§Øª Ø§Ù„Ù‚Ù‡ÙˆØ© ÙˆØ§Ù„Ø´Ø§ÙŠ','ÙØ¹Ø§Ù„ÙŠØ§Øª Ø§Ù„Ø·Ø¨Ø® Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ','Ø§Ø­ØªÙØ§Ù„Ø§Øª Ø§Ù„Ø£Ø¹ÙŠØ§Ø¯ ÙˆØ§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª'
      ];

      const sportsOptions = [
        'ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯Ù…','ÙƒØ±Ø© Ø§Ù„Ø³Ù„Ø©','Ø§Ù„Ø³Ø¨Ø§Ø­Ø©','Ø±ÙŠØ§Ø¶Ø© Ø§Ù„Ù…Ø´ÙŠ ÙˆØ§Ù„Ø¬Ø±ÙŠ','Ø§Ù„ÙŠÙˆØºØ§ ÙˆØ§Ù„Ù„ÙŠØ§Ù‚Ø© Ø§Ù„Ø¨Ø¯Ù†ÙŠØ©','ØªÙ†Ø³ Ø§Ù„Ø·Ø§ÙˆÙ„Ø©'
      ];

      const educationalOptions = [
        'ÙˆØ±Ø´ Ø¹Ù…Ù„ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©','Ø¯ÙˆØ±Ø§Øª ØªØ·ÙˆÙŠØ± Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª','Ù…Ø­Ø§Ø¶Ø±Ø§Øª ØªÙˆØ¹ÙˆÙŠØ©','Ø¬Ù„Ø³Ø§Øª Ø¯Ø¹Ù… Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø³ØªØ¬Ø¯ÙŠÙ†','Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ù…Ù‡Ù†ÙŠ'
      ];

      const expectations = [
        'ØªÙˆÙÙŠØ± Ø¨ÙŠØ¦Ø© Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ© Ø¯Ø§Ø¹Ù…Ø©','ØªÙ†Ø¸ÙŠÙ… ÙØ¹Ø§Ù„ÙŠØ§Øª Ù…Ù†ØªØ¸Ù…Ø©','Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ø§Ù„ØªØ£Ù‚Ù„Ù… Ù…Ø¹ Ø§Ù„Ø­ÙŠØ§Ø© ÙÙŠ Ø¨Ø±ÙŠØ·Ø§Ù†ÙŠØ§','Ø±Ø¨Ø· Ø§Ù„Ø·Ù„Ø§Ø¨ Ø¨Ø¨Ø¹Ø¶Ù‡Ù… Ø§Ù„Ø¨Ø¹Ø¶','ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ ÙˆØ§Ù„Ø§Ø³ØªØ´Ø§Ø±ÙŠ','Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„Ø«Ù‚Ø§ÙÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©','ØªÙˆÙÙŠØ± Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù† Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©','ØªÙ…Ø«ÙŠÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø£Ù…Ø§Ù… Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ©'
      ];

      const communicationMethods = [
        'Ù…Ø¬Ù…ÙˆØ¹Ø§Øª ÙˆØ§ØªØ³Ø§Ø¨','Ø­Ø³Ø§Ø¨Ø§Øª ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ','Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ','Ù…ÙˆÙ‚Ø¹ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ù„Ù†Ø§Ø¯ÙŠ','Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª Ø¯ÙˆØ±ÙŠØ©'
      ];

      const toggleCheckbox = (category, value) => {
        setFormData(prev => ({
          ...prev,
          [category]: prev[category].includes(value)
            ? prev[category].filter(item => item !== value)
            : [...prev[category], value]
        }));
      };

      const handleSubmit = async () => {
        if (!formData.gender || !formData.age || !formData.studyLevel) {
          alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©');
          return;
        }

        setIsSubmitting(true);

        const payload = {
          timestamp: new Date().toISOString(),
          ...formData
        };

        try {
          const response = await fetch(BACKEND_ENDPOINT, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });

          const result = await response.json();

          if (!response.ok || !result.success) {
            throw new Error(result.message || 'Submission failed');
          }

          alert('Ø´ÙƒØ±Ø§Ù‹ Ù„Ù…Ø´Ø§Ø±ÙƒØªÙƒ! ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø¬Ø§Ø¨Ø§ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­ âœ…');

          setFormData({
            gender: '', age: '', studyLevel: '', activities: [], culturalActivities: [], socialActivities: [], sportsActivities: [], educationalActivities: [], eventFrequency: '', preferredTime: [], familyActivities: '', expectations: [], communicationMethod: [], volunteerInterest: '', suggestions: '', contactInfo: ''
          });
        } catch (error) {
          console.error(error);
          alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ù…Ù†Ø¸Ù…ÙŠ Ø§Ù„Ù†Ø§Ø¯ÙŠ.');
        } finally {
          setIsSubmitting(false);
        }
      };

      const CheckboxItem = ({ checked, onClick, label }) => (
        <div onClick={onClick} className="flex items-start gap-2 p-3 rounded-lg hover:bg-green-50 cursor-pointer transition-colors">
          <span className="w-5 h-5 border rounded flex-shrink-0 mt-0.5 flex items-center justify-center text-green-600">
            {checked && 'âœ“'}
          </span>
          <span className="text-gray-700">{label}</span>
        </div>
      );

      return (
        <div className="min-h-screen bg-gradient-to-br from-green-50 to-emerald-50 p-4 md:p-8">
          {/* UI unchanged */}
          <button onClick={handleSubmit} disabled={isSubmitting} className="w-full bg-green-600 text-white p-4 rounded-lg">
            {isSubmitting ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...' : 'Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù†'}
          </button>
        </div>
      );
    }

    /* âœ… React 18 FIX */
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<SaudiStudentSurvey />);
  </script>

</body>
</html>
